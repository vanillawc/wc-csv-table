function l(a,c,f=b=>b){const b=Object.create(null);b.options=c||{},b.reviver=f,b.value="",b.entry=[],b.output=[],b.col=1,b.row=1;const i=new RegExp(/"|,|\r\n|\n|\r|[^",\r\n]+/y),g=new RegExp(/^(\r\n|\n|\r)$/);let j=[],d="",e=0;for(;(j=i.exec(a))!==null;){d=j[0];switch(e){case 0:switch(!0){case d==='"':e=3;break;case d===",":e=0,h(b);break;case g.test(d):e=0,h(b),k(b);break;default:b.value+=d,e=2;break}break;case 2:switch(!0){case d===",":e=0,h(b);break;case g.test(d):e=0,h(b),k(b);break;default:throw e=4,Error(`CSVError: Illegal state [row:${b.row}, col:${b.col}]`)}break;case 3:switch(!0){case d==='"':e=4;break;default:e=3,b.value+=d;break}break;case 4:switch(!0){case d==='"':e=3,b.value+=d;break;case d===",":e=0,h(b);break;case g.test(d):e=0,h(b),k(b);break;default:throw Error(`CSVError: Illegal state [row:${b.row}, col:${b.col}]`)}break}}return b.entry.length!==0&&(h(b),k(b)),b.output}function h(a){const c=a.options.typed?n(a.value):a.value;a.entry.push(a.reviver(c,a.row,a.col)),a.value="",a.col++}function k(a){a.output.push(a.entry),a.entry=[],a.row++,a.col=1}function n(a){const c=new RegExp(/.\./);switch(!0){case a==="true":case a==="false":return a==="true";case c.test(a):return parseFloat(a);case isFinite(a):return parseInt(a);default:return a}}class m extends HTMLElement{static get observedAttributes(){return["src","no-headers"]}attributeChangedCallback(a,c,f){if(!this.__initialized)return;c!==f&&(a==="no-headers"?this.noHeaders=f:this[a]=f)}get src(){return this.getAttribute("src")}set src(a){this.setAttribute("src",a),this.setSrc(a)}get value(){return this.__data}set value(a){this.setValue(a)}get noHeaders(){return this.hasAttribute("no-headers")}set noHeaders(a){const c=this.hasAttribute("no-headers");c?this.setAttribute("no-headers",""):this.removeAttribute("no-headers"),this.setNoHeaders(c)}constructor(){super();this.__initialized=!1,this.__headers=!0,this.__data=[],this.__table=document.createElement("table"),this.appendChild(this.__table)}async connectedCallback(){this.hasAttribute("no-headers")&&(this.__headers=!1),this.hasAttribute("src")&&this.setSrc(),this.__initialized=!0}async setSrc(){if(this.hasAttribute("src")){const a=await this.fetchSrc(this.src);this.__data=l(a),this.render()}}async fetchSrc(a){const c=await fetch(a);if(c.status!==200)throw Error(`ERR ${c.status}: ${c.statusText}`);return c.text()}setValue(a){this.__data=l(a),this.render()}setNoHeaders(a){this.__headers=!a,this.render()}render(){const a=[...this.__data],c=document.createElement("table");if(this.__headers){const b=a.shift(),i=document.createElement("thead"),g=document.createElement("tr");b.forEach(j=>{const d=document.createElement("th");d.innerText=j,g.appendChild(d)}),i.append(g),c.appendChild(i)}const f=document.createElement("tbody");a.forEach(b=>{const i=document.createElement("tr");b.forEach(g=>{const j=document.createElement("td");j.innerText=g,i.appendChild(j)}),f.appendChild(i)}),c.appendChild(f),this.removeChild(this.__table),this.__table=c,this.appendChild(this.__table)}}customElements.define("wc-csv-table",m);export{m as WCCSVTable};
